"use client"

import "@/app/globals.css"
import {useEffect, useState} from "react";
import siteMap from "@/siteMap.json"
import { useSelectedLayoutSegment, useSelectedLayoutSegments } from "next/navigation";
import Link from "next/link";

const MenuLayout = () => {

    const segment = useSelectedLayoutSegment();
    const segments = useSelectedLayoutSegments();

    type siteMenu = {
        index: number,
        name: string,
        url: string,
        level: number,
        parent: number | null,
        child: Array<siteMenu>
    };
    type siteMenus = {
        menu : Array<siteMenu>
    };

    useEffect(() => {
        setMenu(siteMap);
    }, []);

    const [menu, setMenu] = useState<siteMenus>({menu: []});

    const getChildMenu = (curSegment: string | null) => {
        let target: siteMenu | undefined;
        let urlDepth: number = 1;
        let targetIndex: number = 0;

        urlDepth = curSegment !== null ? curSegment.split('/').length : 1;

        if(urlDepth == 1) {
            targetIndex = menu.menu.findIndex((item: siteMenu, index: number) => item.url.split('/')[1] === curSegment);
        }
        if(urlDepth >= 2) {
            targetIndex = menu.menu.findIndex((item: siteMenu, index: number) => item.url.split('/')[1] === segments[0]);
        }

        return menu.menu[targetIndex]?
            menu.menu[targetIndex].child.map((item: siteMenu, index: number) => (<li key={item.index}><Link href={item.url}>{item.name}</Link></li>))
            : <></>
        ;
    };

    return (
        <>
            <div className="flex w-full h-10 bg-black place-content-center">
                <div className="flex w-11/12 h-full items-center space-x-4 text-white">
                    <ul className="flex items-center space-x-7">
                        <li>시장<svg viewBox="0 0 24 24" width="1em" fill="none" className="inline-block navbar_nav_item_link_icon___VMUb"><path stroke="currentColor" d="m22 7-9.5 9.5L3 7"></path></svg></li>
                        <li>★ 내 관심목록</li>
                        {menu.menu.map((item: siteMenu, index: number) => (<li key={item.index}><Link href={item.url}>{item.name}</Link></li>))}
                        <li><svg width="80" height="17.582417582417584" viewBox="0 0 182 40" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M84.8691 9.49235L90.2906 8V12.6014L84.8691 14.0938V9.49235Z" fill="#FFA500"></path><path data-text="1" d="M0.713867 10.5962L6.62816 8.97949V31.4891H0.713867V10.5962ZM24.8639 31.4891H19.4425V23.2812C19.4425 21.2914 19.5657 18.9285 16.9782 18.9285C14.3907 18.9285 13.8978 20.4208 13.8978 22.4106V31.4891H8.47638V15.6951L13.6514 14.3271V17.3118C14.2131 16.4033 14.9935 15.6531 15.9199 15.1312C16.8464 14.6093 17.8886 14.3327 18.9496 14.3271C23.2621 14.3271 24.8639 16.8143 24.8639 20.7939V31.4891ZM30.0389 31.4891L24.4942 14.8245H30.1621L33.2425 26.0171L36.3228 14.8245H41.7443L36.1996 31.4891H30.0389ZM52.5871 20.7939C52.4255 20.0458 52.024 19.3724 51.4449 18.8778C50.8658 18.3832 50.1413 18.095 49.3836 18.0579C46.9193 18.0579 45.8103 20.2965 45.8103 22.6594L52.5871 20.7939ZM49.8764 28.38C51.0417 28.3802 52.1915 28.1114 53.238 27.594C54.2844 27.0767 55.1997 26.3246 55.9139 25.3953L57.3925 29.3749C55.1573 31.0783 52.4307 31.9956 49.63 31.9865C44.3318 31.9865 40.5121 28.8775 40.5121 23.1568C40.495 21.9819 40.7137 20.8157 41.1551 19.7285C41.5964 18.6412 42.2513 17.6554 43.0802 16.8303C43.9091 16.0053 44.8949 15.3582 45.9782 14.928C47.0615 14.4978 48.2199 14.2934 49.3836 14.3271C54.5586 14.3271 57.7621 17.8092 57.7621 23.0324L46.3032 26.2659C46.6216 26.9381 47.132 27.4987 47.7689 27.8755C48.4057 28.2523 49.1398 28.428 49.8764 28.38ZM68.2354 21.167C69.4812 21.3307 70.6898 21.7093 71.8086 22.2863C72.4245 22.6974 72.9353 23.2497 73.2993 23.8981C73.6634 24.5465 73.8703 25.2726 73.9032 26.0171C73.9032 30.4942 69.8372 31.9865 65.8943 31.9865C61.9514 31.9865 58.6246 30.7429 58.0086 27.012L62.5675 25.644C62.5986 26.0528 62.7095 26.4513 62.8938 26.8167C63.0781 27.182 63.3321 27.5069 63.6413 27.7728C63.9505 28.0386 64.3088 28.2401 64.6954 28.3657C65.0821 28.4912 65.4895 28.5384 65.8943 28.5044C67.0032 28.5044 68.605 28.0069 68.605 26.6389C68.605 25.271 66.88 25.1466 65.8943 24.8979L63.7996 24.4004C61.0889 23.903 58.3782 23.0324 58.3782 19.4259C58.3782 15.8194 62.6907 14.3271 65.8943 14.3271C69.0979 14.3271 72.9175 15.322 73.4104 18.6798L68.7282 19.9234C68.4818 18.431 67.4961 17.9336 65.7711 17.9336C64.0461 17.9336 63.7996 18.1823 63.7996 19.1772C63.7996 20.1721 65.6479 20.6696 66.5104 20.9183L68.2354 21.167ZM80.1872 18.431V25.8928C80.1872 26.6389 80.4336 27.2608 81.1729 27.3851C82.1531 27.5973 83.1707 27.5545 84.13 27.2608L83.0211 31.4891H80.5568C75.9979 31.4891 74.7657 30.2455 74.7657 25.644V11.8398L80.1872 10.3475V14.8245H84.13L83.1443 18.431H80.1872ZM84.8693 15.8194L90.2907 14.3271V31.4891H84.8693V15.8194ZM103.105 23.2812C103.105 21.2914 103.228 18.9285 100.518 18.9285C100.08 18.9253 99.6467 19.0162 99.2467 19.1953C98.8466 19.3743 98.489 19.6373 98.1975 19.9668C97.9061 20.2962 97.6875 20.6846 97.5564 21.106C97.4253 21.5274 97.3847 21.9721 97.4372 22.4106V31.4891H92.139V15.6951L97.314 14.3271V17.3118C97.8756 16.4033 98.6561 15.6531 99.5825 15.1312C100.509 14.6093 101.551 14.3327 102.612 14.3271C106.925 14.3271 108.526 16.8143 108.526 20.7939V31.4891H103.105V23.2812ZM118.26 18.5554C115.796 18.5554 115.057 20.6696 115.057 22.6594C115.057 24.6491 115.919 26.6389 118.137 26.6389C120.355 26.6389 121.464 24.8979 121.464 22.7837C121.464 20.6696 120.602 18.5554 118.26 18.5554ZM118.014 37.3341C114.81 37.3341 111.36 36.4636 110.251 32.8571L115.057 31.6134C115.29 32.2791 115.725 32.8537 116.3 33.2556C116.875 33.6575 117.561 33.8661 118.26 33.852C120.478 33.852 121.341 31.9865 121.341 29.8724V28.2557C120.884 29.0283 120.234 29.6653 119.455 30.1022C118.676 30.539 117.796 30.7601 116.905 30.7429C111.976 30.7429 109.635 27.2608 109.635 22.535C109.635 17.8092 112.223 14.3271 116.905 14.3271C117.808 14.3224 118.696 14.5623 119.476 15.0216C120.256 15.4809 120.9 16.1429 121.341 16.9387V15.6951L126.516 14.3271V29.4993C126.516 34.7225 122.696 37.3341 118.014 37.3341Z" fill="white"></path><path d="M129.217 7.97278H137.248C138.395 7.97278 139.498 8.08414 140.555 8.30687C141.635 8.52959 142.58 8.90823 143.39 9.44277C144.2 9.95504 144.841 10.6566 145.313 11.5475C145.808 12.4162 146.056 13.5075 146.056 14.8216C146.056 16.3139 145.797 17.5166 145.279 18.4298C144.762 19.3429 144.065 20.0557 143.187 20.5679C142.31 21.0579 141.286 21.392 140.116 21.5702C138.969 21.7484 137.766 21.8375 136.506 21.8375H133.469V31.6263H129.217V7.97278ZM136.033 18.2293C136.641 18.2293 137.271 18.207 137.923 18.1625C138.575 18.118 139.172 17.9843 139.712 17.7616C140.274 17.5389 140.724 17.2048 141.061 16.7593C141.421 16.3139 141.601 15.6902 141.601 14.8884C141.601 14.1534 141.444 13.5743 141.129 13.1512C140.814 12.7057 140.409 12.3716 139.914 12.1489C139.419 11.9039 138.868 11.748 138.26 11.6812C137.653 11.6143 137.068 11.5809 136.506 11.5809H133.469V18.2293H136.033Z" fill="url(#paint0_linear:r0:)"></path><path d="M147.26 15.59H151.31V18.1291H151.377C151.827 17.1936 152.468 16.4698 153.301 15.9575C154.133 15.4452 155.089 15.1891 156.169 15.1891C156.417 15.1891 156.653 15.2114 156.878 15.2559C157.125 15.3005 157.62 15.423 157.62 15.423L155.663 18.9977C155.663 18.9977 153.953 19.1759 153.368 19.5323C152.806 19.8664 152.367 20.2561 152.052 20.7016C151.76 21.147 151.557 21.5925 151.445 22.0379C151.355 22.4834 151.31 22.8175 151.31 23.0402V31.6263H147.26V15.59Z" fill="url(#paint1_linear:r0:)"></path><path d="M156.231 23.6082C156.231 22.3386 156.456 21.1916 156.906 20.167C157.379 19.1202 158.009 18.2293 158.796 17.4943C159.583 16.7593 160.517 16.1914 161.597 15.7905C162.677 15.3896 163.824 15.1891 165.039 15.1891C166.254 15.1891 167.401 15.3896 168.481 15.7905C169.561 16.1914 170.494 16.7593 171.282 17.4943C172.069 18.2293 172.688 19.1202 173.138 20.167C173.61 21.1916 173.846 22.3386 173.846 23.6082C173.846 24.8777 173.61 26.0359 173.138 27.0827C172.688 28.1072 172.069 28.987 171.282 29.722C170.494 30.457 169.561 31.0249 168.481 31.4258C167.401 31.8267 166.254 32.0272 165.039 32.0272C163.824 32.0272 162.677 31.8267 161.597 31.4258C160.517 31.0249 159.583 30.457 158.796 29.722C158.009 28.987 157.379 28.1072 156.906 27.0827C156.456 26.0359 156.231 24.8777 156.231 23.6082ZM160.281 23.6082C160.281 24.2318 160.382 24.8331 160.584 25.4122C160.809 25.9913 161.124 26.5036 161.529 26.949C161.957 27.3945 162.463 27.7509 163.048 28.0181C163.633 28.2854 164.296 28.419 165.039 28.419C165.781 28.419 166.445 28.2854 167.03 28.0181C167.615 27.7509 168.11 27.3945 168.515 26.949C168.942 26.5036 169.257 25.9913 169.459 25.4122C169.684 24.8331 169.797 24.2318 169.797 23.6082C169.797 22.9845 169.684 22.3832 169.459 21.8041C169.257 21.225 168.942 20.7127 168.515 20.2673C168.11 19.8218 167.615 19.4654 167.03 19.1982C166.445 18.9309 165.781 18.7973 165.039 18.7973C164.296 18.7973 163.633 18.9309 163.048 19.1982C162.463 19.4654 161.957 19.8218 161.529 20.2673C161.124 20.7127 160.809 21.225 160.584 21.8041C160.382 22.3832 160.281 22.9845 160.281 23.6082Z" fill="url(#paint2_linear:r0:)"></path><defs><linearGradient id="paint0_linear:r0:" x1="129.217" y1="12.5164" x2="147.954" y2="40.5234" gradientUnits="userSpaceOnUse"><stop></stop><stop offset="1"></stop></linearGradient><linearGradient id="paint1_linear:r0:" x1="129.217" y1="12.5164" x2="147.954" y2="40.5234" gradientUnits="userSpaceOnUse"><stop></stop><stop offset="1"></stop></linearGradient><linearGradient id="paint2_linear:r0:" x1="129.217" y1="12.5164" x2="147.954" y2="40.5234" gradientUnits="userSpaceOnUse"><stop></stop><stop offset="1"></stop></linearGradient></defs></svg></li>
                        <li>더보기<svg viewBox="0 0 24 24" width="1em" fill="none" className="inline-block navbar_nav_item_link_icon___VMUb"><path stroke="currentColor" d="m22 7-9.5 9.5L3 7"></path></svg></li>
                    </ul>
                </div>
            </div>
            <div className="flex w-full h-8 bg-gray-200 place-content-center">
                <div className="flex w-11/12 h-full items-center space-x-4 text-black">
                    <ul className="flex items-center space-x-7">
                        {getChildMenu(segment)}
                    </ul>
                </div>
            </div>
        </>
    );
}

export default MenuLayout;